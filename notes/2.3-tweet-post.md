# Course Instructions 2.3
## Post your first tweet under current user account

* Load user profile to HTML after authentication
    * remove `index.html` user profile placeholder under `<div class="col-2of5 bg-white profile"></div>`
    * create `displayUser` function and pass in user instance as parameter, use JQuery DOM creation methods to insert user data into `profile` node
    ```
        var displayUser = (user) => {
        let profile = $('.profile')
        $('<img>').addClass('avatar').attr({
            'src': user.avatarUrl,
            'alt': 'avatar'
        }).appendTo(profile)
        $('<h3>').text(user.name).appendTo(profile)
        $('<h5>').text('@' + user.username).appendTo(profile)
        if (user.location) $('<h4><i class="fas fa-map-marker-alt"></i> ' + user.location + '</h4>').appendTo(profile)
        if (user.location) $('<p>').addClass('center').text(user.bio).appendTo(profile)
        $('.avatar-sm').attr('src', user.avatarUrl)
    }
    ```
    * check if we have `user` in LocalStorage, use AJAX to GET user profile detail as `user` object
    * insert user token in `beforeSend` attribute of `$.ajax()` function, use `xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token)` as the request header constructor
    * call `displayUser` function if current url is at `index.html` or `profile.html` to display user information on the page
    * if current user is not authorized, redirect url to `login.html` by using `window.location.replace("/login.html")`
    ```
    if (localStorage.user) {
        $.ajax({
            type: "GET",
            url: baseUrl + "profile/" + localStorage.user,
            beforeSend: function (xhr) {
                if (localStorage.token) {
                    xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                }
            },
            success: function (data) {
                if (data.success) {
                    if (window.location.pathname === '/index.html' || window.location.pathname === '/profile.html') {
                        displayUser(data.profile)
                    }
                } else {
                    localStorage.user = null
                    window.location.replace("/login.html")
                }
            },
            error: function () {
                console.log("Auth Check Failed")
            }
        });
    }
    ```

* Refactor load tweet into `prependTweet` function
    * create a `prependTweet` function and move all tweet loading code into it
    ```
    var prependTweet = (tweet) => {
        let tweetContainer = $('<div>').addClass('tweet').append()
        let row = $('<div>').addClass('row').appendTo(tweetContainer)
        $('<img>').addClass('avatar-sm').attr({
            'src': tweet.author.avatarUrl,
            'alt': 'avatar'
        }).appendTo(row)
        $('<h4><b>' + tweet.author.name + '</b></h4>').appendTo(row)
        $('<h5>@' + tweet.author.username + '</h5>').appendTo(row)
        $('<h5>').text(moment(tweet.createdAt).calendar()).appendTo(row)
        let content = $('<p>').text(tweet.content).appendTo(tweetContainer)
        if (tweet.imageUrl) {
            $('<br><img src="' + tweet.imageUrl + '" alt="tweet">').appendTo(content)
        }
        $('#tweet-list').prepend(tweetContainer)
    }
    ```
    * use `prependTweet(tweet)` to replace existing lines in `loadAllTweets` function
    ```
    var loadAllTweets = () => {
        $.ajax({
            type: 'GET',
            url: baseUrl + 'tweet',
            success: (data) => {
                for (let tweet of data.tweets) {
                    prependTweet(tweet)
                }
            },
            error: (err) => {
                console.log(err.statusText)
            }
        });
    }
    ```

* Update tweet form template under `.tweet` div in `index.html`
    * change `action="#"` to `id="tweet-form"`
    * add IDs for inputs, textarea and buttons
    * the complete form should be
    ```
    <form id="tweet-form">
        <div class="row">
            <img class="avatar-sm v-top" src="img/avatar.jpg" alt="avatar">                       
            <textarea class="input-tweet" placeholder="What's up?" id="tweet-content"></textarea>
        </div>
        <div class="row tweet-actions">
            <input class="hidden" type="file" id="tweet-image">
            <button class="btn-clear" type="button"><i class="far fa-image" id="tweet-image-btn"></i></button>
            <button class="btn-primary" type="button" id="post-btn" disabled>Post</button>
        </div>
    </form>
    ```

* Create new tweet function
    * Initialize an empty tweet variable `var newTweet = {}`
    * Enable post tweet button when the content is valid, use `.keyup()` JQuery function to detect if the `tweet-content` input has content when typing
    ```
    $('#tweet-content').keyup(() => {
        newTweet.content = $('#tweet-content').val()
        newTweet.content ? $('#post-btn').prop('disabled', false) : $('#post-btn').prop('disabled', true)
    })
    ```
    * attach AJAX POST event to `#post-btn`, send user token along with tweet content in order to link it to current user
    ```
    $('#post-btn').click(() => {
        $.ajax({
            type: "POST",
            url: baseUrl + "tweet",
            data: {
                content: newTweet.content
            },
            beforeSend: function (xhr) {
                if (localStorage.token) {
                    xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                }
            },
            success: function (data) {
                if (data.success) {
                    $('#tweet-form').trigger("reset")
                    $('#post-btn').prop('disabled', true)
                    prependTweet(data.tweet)
                } else {
                    console.log(data.error.message)
                }
            },
            error: function () {
                console.log("Authentication Failed")
            }
        });
    })
    ```

* Polish button styles in `main.css`
    * add `transition: background-color .3s ease, border-color .3s ease;` to `button` elements to make hover effects smoother
    * add button disabled style `button:disabled { background-color: #ddd; border-color: #ddd }`

## Challenge
* Refactor usable code into functions, aka DRY (Don't Repeat Yourself)
* Set HTTP request header using `xhr.setRequestHeader`
* Check input value when typing